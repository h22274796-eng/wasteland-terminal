<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siberia-7 Terminal</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background-color: #0d0d0d; 
            color: #00ff41; 
            font-family: 'Courier New', monospace; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            margin: 0; 
            height: 100vh;
            overflow: hidden;
        }
        .monitor { 
            border: 2px solid #00ff41; 
            padding: 15px; 
            width: 90%; 
            box-shadow: 0 0 15px #00ff41; 
            background: rgba(0, 255, 65, 0.05); 
            margin-bottom: 20px;
        }
        .stat-row { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 10px; 
            border-bottom: 1px solid rgba(0, 255, 65, 0.3); 
            font-size: 1.2em;
        }
        .btn { 
            background: #00ff41; 
            color: #0d0d0d; 
            border: none; 
            padding: 18px; 
            margin-top: 10px; 
            font-weight: bold; 
            cursor: pointer; 
            width: 100%; 
            text-transform: uppercase;
            font-size: 14px;
        }
        .log-box {
            width: 90%;
            height: 100px;
            border: 1px solid #004411;
            background: #000;
            padding: 10px;
            font-size: 10px;
            overflow-y: auto;
            color: #008f11;
        }
        .glitch { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="monitor">
        <h2 class="glitch" style="text-align: center;"> TERMINAL v1.0.5 </h2>
        <div class="stat-row"><span>БИОМАССА:</span> <span id="bio">0</span></div>
        <div class="stat-row"><span>ЛОМ:</span> <span id="scrap">0</span></div>
        <div class="stat-row"><span>ЭНЕРГИЯ:</span> <span id="energy">100%</span></div>
    </div>

    <div id="log" class="log-box">Инициализация систем... Готово.</div>

    <button class="btn" onclick="runRaid()">ВЫЙТИ В РЕЙД (+15 лома)</button>
    <button class="btn" style="background: #ff4100; color: #000;" onclick="closeAndSave()">СОХРАНИТЬ И ВЫЙТИ</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // Инициализация данных из ссылки
        const urlParams = new URLSearchParams(window.location.search);
        let currentScrap = parseInt(urlParams.get('scrap')) || 0;
        let earnedThisSession = 0;

        // Отображаем стартовые значения
        document.getElementById('bio').innerText = urlParams.get('bio') || '0';
        document.getElementById('scrap').innerText = currentScrap;
        document.getElementById('energy').innerText = (urlParams.get('energy') || '100') + '%';

        function addLog(msg) {
            const logBox = document.getElementById('log');
            logBox.innerHTML += `<br>> ${msg}`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function runRaid() {
            // Мгновенно обновляем интерфейс
            earnedThisSession += 15;
            document.getElementById('scrap').innerText = currentScrap + earnedThisSession;
            
            addLog("Рейд выполнен. Лом найден.");
            
            // Тактильная отдача
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function closeAndSave() {
            if (earnedThisSession > 0) {
                addLog("Синхронизация с базой...");
                // Отправляем суммарный результат боту
                tg.sendData(`save_scrap:${earnedThisSession}`);
            } else {
                tg.close();
            }
        }
    </script>
</body>
</html>
